#! /usr/bin/env python
# SETUPTOOLS_DO_NOT_WRAP

import sys
import traceback
import kmltrack.fileconverter


def parse_argv(argv):
    options = {}
    args = []
    for item in argv:
        if item.startswith('--'):
            item = item[2:]
            if '=' in item:
                key, value = item.split('=', 1)
                options[key] = value
            else:
                options[item] = True
        else:
            args.append(item)

    return args, options


def print_help():
    print """Usage: kmltrack [OPTIONS] INFILE OUTFILE

Options:
    --map-lat=SRC_COL_NAME
    --map-lon=SRC_COL_NAME
    --map-timestamp=SRC_COL_NAME
"""



args, options = parse_argv(sys.argv[1:])

if '--help' in options:
    print_help()
else:
    try:

        options['column_map'] = {}
        for key, value in options.iteritems():
            if key.startswith('map-'):
                key = key.split("-", 1)[1]
                options['column_map'][key] = value

        if 'format' not in options and '.' in args[0]:
            options['format'] = args[0].split('.')[-1]

        converter = getattr(kmltrack.fileconverter, "%s_to_kml" % (options['format'],))

        converter(*args, **options)
    except Exception, e:
        print e
        traceback.print_exc()
        print_help()
